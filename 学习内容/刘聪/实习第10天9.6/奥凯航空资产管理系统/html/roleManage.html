<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>角色管理</title>
    <script src="../layui/layui.js"></script>
    <link rel="stylesheet" href="../layui/css/layui.css">
    <link rel="stylesheet" href="../css/reset.css">

</head>
<body>

<div class="layui-fluid">
    <!--    layui卡片-->
    <div class="layui-card">
        <div class="layui-card-header">角色管理列表</div>
        <div class="layui-card-body">
            <!--            结合栅格化布局完成页面布局-->
            <div class="layui-row layui-col-space10">
                <!--                放置添加按钮-->
                <div class="layui-col-xs1 layui-col-xs-offset11">
                    <button class="layui-btn layui-btn-fluid" id="btn_Add">
                        <i class="layui-icon layui-icon-add-1"></i>
                        添加
                    </button>
                </div>
                <div class="layui-col-xs12">
                    <!--                    lay-filter属性为了做识别-->
                    <table id="data_Role" lay-filter="role">

                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
<script type="text/html" id="tpl_Operate">
    <div class="layui-btn-group">
        <button class="layui-btn layui-btn-primary" lay-event="view">
            <i class="layui-icon layui-icon-camera"></i>查看
        </button>
        <button class="layui-btn layui-btn-warm" lay-event="update">
            <i class="layui-icon layui-icon-edit"></i>编辑
        </button>
        <button class="layui-btn layui-btn-danger" lay-event="delete">
            <i class="layui-icon layui-icon-delete"></i>删除
        </button>
    </div>
</script>
<script>
    layui.use(['table', 'jquery', 'layer'], function () {
        var table = layui.table,
            $ = layui.$,
            layer = parent === self ? layui.layer : top.layui.layer;
        //初始化角色数据（从后台远程加载）
        /* "roleId": 1,
             "roleName": "超级管理员",
             "code": "001",
             "description": "拥有最大权限1"*/

        table.render({
            elem: "#data_Role",
            url: 'http://140.143.186.38:8088/api/Role',
            page: true,
            cols: [[
                {
                    field: 'roleId',
                    title: '角色编号',
                    width: '12%',
                    aling: 'center',
                },
                {
                    field: 'roleName',
                    title: '角色名',
                    width: '12%',
                    align: 'center',
                },
                {
                    field: 'code',
                    title: '码',
                    width: '7%',
                    align: 'center',
                },
                {
                    field: 'description',
                    title: '角色描述',
                    width: '27%',
                    //align:'center',
                },
                {
                    title: "操作",
                    toolbar: '#tpl_Operate',
                    align: "center"
                }
            ]]
        });
        //工具栏的点击事件
        table.on('tool(role)', function (object) {
            //回调函数中携带的参数object可以获取当前行的数据，还有标记事件的名称
            var event = object.event;
            var data = object.data;
            //判断是否点击删除按钮
            if (event === 'delete') {
                layer.confirm(
                    '确定要删除角色吗？',
                    {
                        title: '提示信息',
                        icon: 3
                    },
                    function (layerIndex) {
                        //layerIndex弹出层的索引，关闭弹窗时需要用到
                        layer.close(layerIndex);
                        $.ajax({
                            url: 'http://140.143.186.38:8088/api/Role/' + data.roleId,
                            type: "DELETE",
                            success: function (res) {
                                if (res.code === 0) {
                                    layer.alert(res.data, {
                                        icon: 1,
                                        title: '信息提示'
                                    }, function (alertIndex) {
                                        layer.close(alertIndex);
                                        refreshTable();
                                    })
                                } else {
                                    layer.alert(res.msg, {
                                        icon: 2,
                                        title: '错误提示'
                                    })
                                }
                            }
                        })
                    }
                )
            }

            //编辑
            if (event === 'view') {
                layer.open({
                    type: 2,
                    content: 'roleDetail.html?roleId=' + data.roleId,
                    area: ['960px', '540px'],
                    title: '角色详情'
                })
            }
            //修改
            if (event === 'update') {
                layer.open({
                    type: 2,
                    content: 'roleUpdate.html?roleId=' + data.roleId,
                    area: ['960px', '640px'],
                    title: '修改学员信息'
                })
            }
        })
        //添加按钮事件
        $('#btn_Add').click(function () {
            layer.open({
                type: 2,
                content: 'roleAdd.html',
                area: ['960px', '640px'],
                title: '添加角色信息',
                //弹窗关闭销毁时调用
                end: function () {
                    refreshTable();
                }
            })
        })


        //刷新数据列表
        var refreshTable = function () {
            table.reload('data_Role', {})
        }
    })
</script>
</body>
</html>